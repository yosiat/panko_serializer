"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[657],{5680:(e,n,t)=>{t.d(n,{xA:()=>p,yg:()=>d});var a=t(6540);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},u="mdxType",y={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(t),m=i,d=u["".concat(l,".").concat(m)]||u[m]||y[m]||r;return t?a.createElement(d,o(o({ref:n},p),{},{components:t})):a.createElement(d,o({ref:n},p))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[u]="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=t[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5280:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>c,toc:()=>u});var a=t(8168),i=t(8587),r=(t(6540),t(5680)),o=["components"],s={id:"associations",title:"Associations",sidebar_label:"Associations"},l=void 0,c={unversionedId:"associations",id:"associations",title:"Associations",description:"A serializer can define it's own associations - both hasmany and hasone to serializer under the context of the object.",source:"@site/docs/associations.md",sourceDirName:".",slug:"/associations",permalink:"/docs/associations",draft:!1,tags:[],version:"current",frontMatter:{id:"associations",title:"Associations",sidebar_label:"Associations"},sidebar:"docs",previous:{title:"Attributes",permalink:"/docs/attributes"},next:{title:"Response",permalink:"/docs/response-bag"}},p={},u=[{value:"Associations with aliases",id:"associations-with-aliases",level:3},{value:"Inference",id:"inference",level:3},{value:"Nested Filters",id:"nested-filters",level:2}],y={toc:u},m="wrapper";function d(e){var n=e.components,t=(0,i.A)(e,o);return(0,r.yg)(m,(0,a.A)({},y,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"A serializer can define it's own associations - both ",(0,r.yg)("inlineCode",{parentName:"p"},"has_many")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"has_one")," to serializer under the context of the object."),(0,r.yg)("p",null,"For example:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-ruby"},"\nclass PostSerializer < Panko::Serializer\n  attributes :title, :body\n\n  has_one :author, serializer: AuthorSerializer\n  has_many :comments, each_serializer: CommentSerializer\nend\n\n")),(0,r.yg)("h3",{id:"associations-with-aliases"},"Associations with aliases"),(0,r.yg)("p",null,"An association key name can be aliased with the ",(0,r.yg)("inlineCode",{parentName:"p"},"name")," option."),(0,r.yg)("p",null,"For example:\nthe ",(0,r.yg)("inlineCode",{parentName:"p"},"actual_author")," property will be converted to ",(0,r.yg)("inlineCode",{parentName:"p"},"alias_author"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-ruby"},"\nclass PostSerializer < Panko::Serializer\n  attributes :title, :body\n\n  has_one :actual_author, serializer: AuthorSerializer, name: :alias_author\n  has_many :comments, each_serializer: CommentSerializer\nend\n\n")),(0,r.yg)("h3",{id:"inference"},"Inference"),(0,r.yg)("p",null,"Panko can find the type of the serializer by looking at the realtionship name, so instead specifying\nthe serializer at the above example, we can -"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-ruby"},"\nclass PostSerializer < Panko::Serializer\n  attributes :title, :body\n\n  has_one :author\n  has_many :comments\nend\n\n")),(0,r.yg)("p",null,"The logic of inferencing is -"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Take the name of the relationship (for example - ",(0,r.yg)("inlineCode",{parentName:"li"},":author")," / ",(0,r.yg)("inlineCode",{parentName:"li"},":comments"),") singularize and camelize it"),(0,r.yg)("li",{parentName:"ul"},'Look for const defined with the name aboe and "Serializer" suffix (by using ',(0,r.yg)("inlineCode",{parentName:"li"},"Object.const_get"),")")),(0,r.yg)("p",null,">"," If Panko can't find the serializer it will throw an error on startup time, for example: ",(0,r.yg)("inlineCode",{parentName:"p"},"Can't find serializer for PostSerializer.author has_one relationship")),(0,r.yg)("h2",{id:"nested-filters"},"Nested Filters"),(0,r.yg)("p",null,"As talked before, Panko allows you to filter the attributes of a serializer.\nBut Panko let you take that step further, and filters the attributes of you associations so you can re-use your serializers in your application."),(0,r.yg)("p",null,"For example, let's say one portion of the application needs to serializer list of posts and serializer their - ",(0,r.yg)("inlineCode",{parentName:"p"},"title"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"body"),", author's id and comments id."),(0,r.yg)("p",null,"We can declare tailored serializer for this, or we can re-use the above defined serializer - ",(0,r.yg)("inlineCode",{parentName:"p"},"PostSerializer")," and use nested filters."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-ruby"},"\nposts = Post.all\n\nPanko::ArraySerializer.new(posts, each_serializer: PostSerializer, only: {\n  instance: [:title, :body, :author, :comments],\n  author: [:id],\n  comments: [:id],\n})\n\n")),(0,r.yg)("p",null,"Let's dissect ",(0,r.yg)("inlineCode",{parentName:"p"},"only")," option we passed -"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"instance")," - list of attributes (and associations) we want to serializer for current instance of the serializer, in this case - ",(0,r.yg)("inlineCode",{parentName:"li"},"PostSerializer"),"."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"author"),", ",(0,r.yg)("inlineCode",{parentName:"li"},"comments")," - here we specify the list of attributes we want to serialize for each association.")),(0,r.yg)("p",null,"It's important to note that Nested Filters, are recursive, in other words, we can filter the association's associations."),(0,r.yg)("p",null,"For example, ",(0,r.yg)("inlineCode",{parentName:"p"},"CommentSerializer")," have has_one association ",(0,r.yg)("inlineCode",{parentName:"p"},"Author"),", and for each ",(0,r.yg)("inlineCode",{parentName:"p"},"comments.author")," we only it's name."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-ruby"},"\nposts = Post.all\n\nPanko::ArraySerializer.new(posts, only: {\n  instance: [:title, :body, :author, :comments],\n  author: [:id],\n  comments: {\n    instance: [:id, :author],\n    author: [:name]\n  }\n})\n\n")),(0,r.yg)("p",null,"As you see now in ",(0,r.yg)("inlineCode",{parentName:"p"},"comments")," the ",(0,r.yg)("inlineCode",{parentName:"p"},"instance")," have different meaning, the ",(0,r.yg)("inlineCode",{parentName:"p"},"CommentSerializer"),"."))}d.isMDXComponent=!0}}]);